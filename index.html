<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Socket.IO OpenAI Test Client</title>
    <script src="https://cdn.socket.io/4.7.4/socket.io.min.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        .status {
            padding: 10px;
            border-radius: 6px;
            margin-bottom: 20px;
            text-align: center;
            font-weight: bold;
        }
        .connected {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .disconnected {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
        }
        input, textarea, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
            box-sizing: border-box;
        }
        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #007bff;
        }
        button {
            background-color: #007bff;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #0056b3;
        }
        button:disabled {
            background-color: #6c757d;
            cursor: not-allowed;
        }
        .response {
            margin-top: 20px;
            padding: 15px;
            border-radius: 6px;
            background-color: #f8f9fa;
            border-left: 4px solid #007bff;
        }
        .response.success {
            background-color: #d4edda;
            border-left-color: #28a745;
        }
        .response.error {
            background-color: #f8d7da;
            border-left-color: #dc3545;
        }
        .response.processing {
            background-color: #fff3cd;
            border-left-color: #ffc107;
        }
        .usage {
            font-size: 14px;
            color: #666;
            margin-top: 10px;
        }
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #007bff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîå Socket.IO OpenAI Test Client</h1>
        
        <div id="status" class="status disconnected">
            –û—Ç–∫–ª—é—á–µ–Ω–æ
        </div>
        
        <div class="form-group">
            <label for="prompt">–°–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è OpenAI:</label>
            <textarea id="prompt" rows="4" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –∑–∞–ø—Ä–æ—Å –∫ OpenAI...">–ü—Ä–∏–≤–µ—Ç! –†–∞—Å—Å–∫–∞–∂–∏ –º–Ω–µ —á—Ç–æ-–Ω–∏–±—É–¥—å –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ–µ –æ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è—Ö.</textarea>
        </div>
        
        <div class="form-group">
            <label for="model">–ú–æ–¥–µ–ª—å:</label>
            <select id="model">
                <option value="gpt-3.5-turbo">GPT-3.5 Turbo</option>
                <option value="gpt-4">GPT-4</option>
                <option value="gpt-4-turbo">GPT-4 Turbo</option>
            </select>
        </div>
        
        <div class="form-group">
            <label for="maxTokens">–ú–∞–∫—Å–∏–º—É–º —Ç–æ–∫–µ–Ω–æ–≤:</label>
            <input type="number" id="maxTokens" value="1000" min="1" max="4000">
        </div>
        
        <div class="form-group">
            <label for="temperature">–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ (–∫—Ä–µ–∞—Ç–∏–≤–Ω–æ—Å—Ç—å):</label>
            <input type="range" id="temperature" min="0" max="2" step="0.1" value="0.7">
            <span id="tempValue">0.7</span>
        </div>
        
        <div class="form-group">
            <label for="personaType">–¢–∏–ø —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∞:</label>
            <select id="personaType">
                <option value="melancholic">–ú–µ–ª–∞–Ω—Ö–æ–ª–∏–∫</option>
                <option value="choleric">–•–æ–ª–µ—Ä–∏–∫</option>
                <option value="phlegmatic">–§–ª–µ–≥–º–∞—Ç–∏–∫</option>
                <option value="sanguine">–°–∞–Ω–≥–≤–∏–Ω–∏–∫</option>
            </select>
        </div>
        
        <div class="form-group">
            <label for="archetypeType">–ê—Ä—Ö–µ—Ç–∏–ø–∏—á–µ—Å–∫–∏–π —Å–ª–æ–π:</label>
            <select id="archetypeType">
                <option value="innocent">–ù–µ–≤–∏–Ω–Ω—ã–π</option>
                <option value="hero">–ì–µ—Ä–æ–π</option>
            </select>
        </div>
        
        <div class="form-group">
            <label for="bigFiveType">BIG FIVE:</label>
            <select id="bigFiveType">
                <option value="openness">–û—Ç–∫—Ä—ã—Ç–æ—Å—Ç—å –æ–ø—ã—Ç—É</option>
                <option value="conscientiousness">–î–æ–±—Ä–æ—Å–æ–≤–µ—Å—Ç–Ω–æ—Å—Ç—å</option>
                <option value="extraversion">–≠–∫—Å—Ç—Ä–∞–≤–µ—Ä—Å–∏—è</option>
                <option value="agreeableness">–î–æ–±—Ä–æ–∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å</option>
                <option value="neuroticism">–ù–µ–≤—Ä–æ—Ç–∏–∑–º</option>
            </select>
        </div>
        
        <div class="form-group">
            <label for="behavioralType">–ü–æ–≤–µ–¥–µ–Ω—á–µ—Å–∫–∏–π —Å–ª–æ–π:</label>
            <select id="behavioralType">
                <option value="analyst">–ê–Ω–∞–ª–∏—Ç–∏–∫</option>
                <option value="diplomat">–î–∏–ø–ª–æ–º–∞—Ç</option>
                <option value="sentinel">–°—Ç—Ä–∞–∂</option>
                <option value="explorer">–ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å</option>
            </select>
        </div>
        
        <div class="form-group">
            <label for="valueType">–¶–µ–Ω–Ω–æ—Å—Ç–Ω—ã–π —Å–ª–æ–π:</label>
            <select id="valueType">
                <option value="hedonism">–ì–µ–¥–æ–Ω–∏–∑–º</option>
                <option value="stimulation">–°—Ç–∏–º—É–ª—è—Ü–∏—è</option>
                <option value="self_direction">–°–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ—Å—Ç—å</option>
                <option value="universalism">–£–Ω–∏–≤–µ—Ä—Å–∞–ª–∏–∑–º</option>
                <option value="benevolence">–î–æ–±—Ä–æ–∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å</option>
                <option value="tradition">–¢—Ä–∞–¥–∏—Ü–∏–∏</option>
                <option value="conformity">–ö–æ–Ω—Ñ–æ—Ä–º–Ω–æ—Å—Ç—å</option>
                <option value="security">–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å</option>
                <option value="power">–í–ª–∞—Å—Ç—å</option>
                <option value="achievement">–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</option>
            </select>
        </div>
        
        <div class="form-group">
            <label for="hobby">–£–≤–ª–µ—á–µ–Ω–∏–µ:</label>
            <select id="hobby">
                <option value="travel">–ü—É—Ç–µ—à–µ—Å—Ç–≤–∏—è</option>
                <option value="music">–ú—É–∑—ã–∫–∞</option>
                <option value="sport">–°–ø–æ—Ä—Ç</option>
                <option value="reading">–ß—Ç–µ–Ω–∏–µ</option>
                <option value="cooking">–ö—É–ª–∏–Ω–∞—Ä–∏—è</option>
                <option value="art">–¢–≤–æ—Ä—á–µ—Å—Ç–≤–æ</option>
            </select>
        </div>
        
        <button id="sendBtn" onclick="sendRequest()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å</button>
        <button id="clearBtn" onclick="clearHistory()" style="margin-left:10px;background:#dc3545;">–°—Ç–µ—Ä–µ—Ç—å –∏—Å—Ç–æ—Ä–∏—é</button>
        <div id="dialog" style="margin-top:30px;"></div>
        <div id="response" style="display: none;"></div>
    </div>

    <script>
        const socket = io('https://socket-io-openai-server-d2e1916bdf82.herokuapp.com');
        const statusDiv = document.getElementById('status');
        const responseDiv = document.getElementById('response');
        const sendBtn = document.getElementById('sendBtn');
        const tempSlider = document.getElementById('temperature');
        const tempValue = document.getElementById('tempValue');
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã
        tempSlider.addEventListener('input', function() {
            tempValue.textContent = this.value;
        });
        
        // Socket.IO —Å–æ–±—ã—Ç–∏—è
        socket.on('connect', () => {
            statusDiv.textContent = '–ü–æ–¥–∫–ª—é—á–µ–Ω–æ';
            statusDiv.className = 'status connected';
            console.log('–ü–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ —Å–µ—Ä–≤–µ—Ä—É');
        });
        
        socket.on('disconnect', () => {
            statusDiv.textContent = '–û—Ç–∫–ª—é—á–µ–Ω–æ';
            statusDiv.className = 'status disconnected';
            console.log('–û—Ç–∫–ª—é—á–µ–Ω–æ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞');
        });
        
        socket.on('openai_response', (data) => {
            console.log('–ü–æ–ª—É—á–µ–Ω –æ—Ç–≤–µ—Ç:', data);
            
            if (data.status === 'processing') {
                showResponse('processing', '–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –≤–∞—à –∑–∞–ø—Ä–æ—Å...', null);
            } else if (data.status === 'success') {
                showResponse('success', data.response, data.usage);
                if (data.messages) {
                    renderDialog(data.messages);
                }
            } else if (data.status === 'error') {
                showResponse('error', `–û—à–∏–±–∫–∞: ${data.error}`, null);
            }
            
            sendBtn.disabled = false;
            sendBtn.textContent = '–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å';
        });
        socket.on('history_cleared', () => {
            document.getElementById('dialog').innerHTML = '';
            showResponse('success', '–ò—Å—Ç–æ—Ä–∏—è —á–∞—Ç–∞ –æ—á–∏—â–µ–Ω–∞.', null);
            // –†–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º –≤—ã–±–æ—Ä –≤—Å–µ—Ö —Å–ª–æ—ë–≤ –ø–æ—Å–ª–µ –æ—á–∏—Å—Ç–∫–∏ –∏—Å—Ç–æ—Ä–∏–∏
            document.getElementById('personaType').disabled = false;
            document.getElementById('archetypeType').disabled = false;
            document.getElementById('bigFiveType').disabled = false;
            document.getElementById('behavioralType').disabled = false;
            document.getElementById('valueType').disabled = false;
            document.getElementById('hobby').disabled = false;
        });
        function clearHistory() {
            socket.emit('clear_history');
        }
        function renderDialog(messages) {
            const dialogDiv = document.getElementById('dialog');
            let html = '';
            messages.forEach(msg => {
                if (msg.role === 'user') {
                    html += `<div style='text-align:right;margin:8px 0;'><span style='display:inline-block;background:#007bff;color:#fff;padding:8px 14px;border-radius:16px 16px 2px 16px;max-width:70%;'>${escapeHtml(msg.content)}</span></div>`;
                } else if (msg.role === 'assistant') {
                    html += `<div style='text-align:left;margin:8px 0;'><span style='display:inline-block;background:#f1f0f0;color:#222;padding:8px 14px;border-radius:16px 16px 16px 2px;max-width:70%;'>${escapeHtml(msg.content)}</span></div>`;
                }
            });
            dialogDiv.innerHTML = html;
        }
        function escapeHtml(text) {
            return text.replace(/[&<>"']/g, function(m) {
                return ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'})[m];
            });
        }
        
        function sendRequest() {
            const prompt = document.getElementById('prompt').value;
            const model = document.getElementById('model').value;
            const maxTokens = parseInt(document.getElementById('maxTokens').value);
            const temperature = parseFloat(document.getElementById('temperature').value);
            const personaType = document.getElementById('personaType').value;
            const archetypeType = document.getElementById('archetypeType').value;
            const bigFiveType = document.getElementById('bigFiveType').value;
            const behavioralType = document.getElementById('behavioralType').value;
            const valueType = document.getElementById('valueType').value;
            const hobby = document.getElementById('hobby').value;
            if (!prompt.trim()) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ');
                return;
            }
            // –ë–ª–æ–∫–∏—Ä—É–µ–º –≤—ã–±–æ—Ä –≤—Å–µ—Ö —Å–ª–æ—ë–≤ –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
            document.getElementById('personaType').disabled = true;
            document.getElementById('archetypeType').disabled = true;
            document.getElementById('bigFiveType').disabled = true;
            document.getElementById('behavioralType').disabled = true;
            document.getElementById('valueType').disabled = true;
            document.getElementById('hobby').disabled = true;
            const request = {
                prompt: prompt,
                model: model,
                max_tokens: maxTokens,
                temperature: temperature,
                personaType: personaType,
                archetypeType: archetypeType,
                bigFiveType: bigFiveType,
                behavioralType: behavioralType,
                valueType: valueType,
                hobby: hobby
            };
            console.log('–û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å:', request);
            socket.emit('openai_request', request);
            sendBtn.disabled = true;
            sendBtn.textContent = '–û—Ç–ø—Ä–∞–≤–ª—è–µ–º...';
            showResponse('processing', '–û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å...', null);
        }
        
        function showResponse(type, message, usage) {
            responseDiv.style.display = 'block';
            responseDiv.className = `response ${type}`;
            
            let html = '';
            if (type === 'processing') {
                html = `<div class="loading"></div> ${message}`;
            } else if (type === 'success') {
                html = `<strong>–û—Ç–≤–µ—Ç –æ—Ç OpenAI:</strong><br>${message}`;
                if (usage) {
                    html += `<div class="usage">
                        <strong>–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤:</strong><br>
                        –ü—Ä–æ–º–ø—Ç: ${usage.prompt_tokens} | –û—Ç–≤–µ—Ç: ${usage.completion_tokens} | –í—Å–µ–≥–æ: ${usage.total_tokens}
                    </div>`;
                }
            } else if (type === 'error') {
                html = `<strong>–û—à–∏–±–∫–∞:</strong><br>${message}`;
            }
            
            responseDiv.innerHTML = html;
        }
    </script>
</body>
</html> 